{"version":3,"file":"jsme.min.js","sources":["../src/jsme.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for handling JSME initialisation in pmatchjme forms.\n *\n * @module     qtype_pmatchjme\n * @class      jsme\n * @copyright  2018 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* global JSApplet */\n\ndefine([], function() {\n\n    \"use strict\";\n\n    /**\n     * @alias qtype_pmatchjme/jsme\n     */\n    var t = {\n        maxLoadingWaits: 10,\n\n        insertApplet: function(containerid, topselector, feedback, readonly, nostereo, autoez) {\n            var jmeoptions = [];\n            if (nostereo) {\n                jmeoptions.push(\"nostereo\");\n            }\n            if (autoez) {\n                jmeoptions.push(\"autoez\");\n            }\n            if (readonly) {\n                jmeoptions.push(\"depict\");\n            }\n            t.showJsme(topselector, containerid, jmeoptions, t.maxLoadingWaits);\n        },\n\n        showJsme: function(topselector, containerid, jmeoptions, remainingloadingwaits) {\n            var topnode = document.querySelector(topselector),\n                jme = false,\n                jsmeApplet = false;\n\n            // Ensure the JSME code is loaded properly. IE 8 struggles.\n            if (typeof JSApplet !== 'object' && remainingloadingwaits > 0) {\n                setTimeout(function() {\n                    t.showJsme(topselector, containerid, jmeoptions, remainingloadingwaits - 1);\n                }, 100);\n                return;\n            }\n\n            // Hide the loading message.\n            document.getElementById(containerid).innerHTML = '';\n            document.getElementById(containerid).classList.remove('qtype_pmatchjme-applet-warning');\n\n            // Instantiate a new JSME.\n            jsmeApplet = new JSApplet.JSME(containerid, '368px', '312px', {\"options\": jmeoptions.join(',')});\n            jsmeApplet.name = containerid;\n\n            // If molecule data is supplied display it.\n            jme = topnode.find('input.jme').val();\n            if (jme) {\n                jsmeApplet.readMolecule(jme);\n            }\n\n            // Add event handler to save the values on form submit.\n            topnode.parents('form').on('submit', function() {\n                topnode.find('input.answer').val(jsmeApplet.smiles());\n                topnode.find('input.jme').val(jsmeApplet.jmeFile());\n                topnode.find('input.mol').val(jsmeApplet.molFile());\n            });\n        }\n    };\n    return t;\n});\n"],"names":["define","t","maxLoadingWaits","insertApplet","containerid","topselector","feedback","readonly","nostereo","autoez","jmeoptions","push","showJsme","remainingloadingwaits","jme","topnode","document","querySelector","jsmeApplet","JSApplet","setTimeout","getElementById","innerHTML","classList","remove","JSME","join","name","find","val","readMolecule","parents","on","smiles","jmeFile","molFile"],"mappings":";;;;;;;;IA0BAA,8BAAO,IAAI,eAOHC,EAAI,CACJC,gBAAiB,GAEjBC,aAAc,SAASC,YAAaC,YAAaC,SAAUC,SAAUC,SAAUC,YACvEC,WAAa,GACbF,UACAE,WAAWC,KAAK,YAEhBF,QACAC,WAAWC,KAAK,UAEhBJ,UACAG,WAAWC,KAAK,UAEpBV,EAAEW,SAASP,YAAaD,YAAaM,WAAYT,EAAEC,kBAGvDU,SAAU,SAASP,YAAaD,YAAaM,WAAYG,2BAEjDC,IADAC,QAAUC,SAASC,cAAcZ,aAEjCa,YAAa,EAGO,gCAAbC,6BAAAA,YAAyBN,sBAAwB,EACxDO,YAAW,WACPnB,EAAEW,SAASP,YAAaD,YAAaM,WAAYG,sBAAwB,KAC1E,MAKPG,SAASK,eAAejB,aAAakB,UAAY,GACjDN,SAASK,eAAejB,aAAamB,UAAUC,OAAO,mCAGtDN,WAAa,IAAIC,SAASM,KAAKrB,YAAa,QAAS,QAAS,SAAYM,WAAWgB,KAAK,QAC/EC,KAAOvB,aAGlBU,IAAMC,QAAQa,KAAK,aAAaC,QAE5BX,WAAWY,aAAahB,KAI5BC,QAAQgB,QAAQ,QAAQC,GAAG,UAAU,WACjCjB,QAAQa,KAAK,gBAAgBC,IAAIX,WAAWe,UAC5ClB,QAAQa,KAAK,aAAaC,IAAIX,WAAWgB,WACzCnB,QAAQa,KAAK,aAAaC,IAAIX,WAAWiB,wBAI9ClC"}