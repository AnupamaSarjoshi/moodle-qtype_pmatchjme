{"version":3,"file":"jsme.min.js","sources":["../src/jsme.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for handling JSME initialisation in pmatchjme forms.\n *\n * @package    qtype\n * @subpackage pmatchjme\n * @copyright  2018 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/*global JSApplet*/\n\ndefine(['jquery'], function($) {\n\n    \"use strict\";\n\n    /**\n     * @alias qtype_pmatchjme/jsme\n     */\n    var t = {\n        max_loading_waits: 10,\n\n        insert_applet: function (containerid, topselector, feedback, readonly, nostereo, autoez) {\n            var jmeoptions = [];\n            if (nostereo) {\n                jmeoptions.push(\"nostereo\");\n            }\n            if (autoez) {\n                jmeoptions.push(\"autoez\");\n            }\n            if (readonly) {\n                jmeoptions.push(\"depict\");\n            }\n            t.show_jsme(topselector, containerid, jmeoptions, t.max_loading_waits);\n        },\n\n        show_jsme: function (topselector, containerid, jmeoptions, remainingloadingwaits) {\n            var topnode = $(topselector),\n                jme = false,\n                jsmeApplet = false;\n\n            // Ensure the JSME code is loaded properly. IE 8 struggles.\n            if (typeof JSApplet !== 'object' && remainingloadingwaits > 0) {\n                setTimeout(function () {\n                    t.show_jsme(topselector, containerid, jmeoptions, remainingloadingwaits - 1);\n                }, 100);\n                return;\n            }\n\n            // Hide the loading message.\n            $('#' + containerid).html('');\n            $('#' + containerid).removeClass('qtype_pmatchjme-applet-warning');\n\n            // Instantiate a new JSME.\n            jsmeApplet = new JSApplet.JSME(containerid, '368px', '312px', {\"options\": jmeoptions.join(',')});\n            jsmeApplet.name = containerid;\n\n            // If molecule data is supplied display it.\n            jme = topnode.find('input.jme').val();\n            if (jme) {\n                jsmeApplet.readMolecule(jme);\n            }\n\n            // Add event handler to save the values on form submit.\n            topnode.parents('form').on('submit', function () {\n                topnode.find('input.answer').val(jsmeApplet.smiles());\n                topnode.find('input.jme').val(jsmeApplet.jmeFile());\n                topnode.find('input.mol').val(jsmeApplet.molFile());\n            });\n        }\n    };\n    return t;\n});\n"],"names":["define","$","t","max_loading_waits","insert_applet","containerid","topselector","feedback","readonly","nostereo","autoez","jmeoptions","push","show_jsme","remainingloadingwaits","jme","topnode","jsmeApplet","JSApplet","setTimeout","html","removeClass","JSME","join","name","find","val","readMolecule","parents","on","smiles","jmeFile","molFile"],"mappings":";;;;;;;;IA0BAA,8BAAO,CAAC,WAAW,SAASC,OAOpBC,EAAI,CACJC,kBAAmB,GAEnBC,cAAe,SAAUC,YAAaC,YAAaC,SAAUC,SAAUC,SAAUC,YACzEC,WAAa,GACbF,UACAE,WAAWC,KAAK,YAEhBF,QACAC,WAAWC,KAAK,UAEhBJ,UACAG,WAAWC,KAAK,UAEpBV,EAAEW,UAAUP,YAAaD,YAAaM,WAAYT,EAAEC,oBAGxDU,UAAW,SAAUP,YAAaD,YAAaM,WAAYG,2BAEnDC,IADAC,QAAUf,EAAEK,aAEZW,YAAa,EAGO,gCAAbC,6BAAAA,YAAyBJ,sBAAwB,EACxDK,YAAW,WACPjB,EAAEW,UAAUP,YAAaD,YAAaM,WAAYG,sBAAwB,KAC3E,MAKPb,EAAE,IAAMI,aAAae,KAAK,IAC1BnB,EAAE,IAAMI,aAAagB,YAAY,mCAGjCJ,WAAa,IAAIC,SAASI,KAAKjB,YAAa,QAAS,QAAS,SAAYM,WAAWY,KAAK,QAC/EC,KAAOnB,aAGlBU,IAAMC,QAAQS,KAAK,aAAaC,QAE5BT,WAAWU,aAAaZ,KAI5BC,QAAQY,QAAQ,QAAQC,GAAG,UAAU,WACjCb,QAAQS,KAAK,gBAAgBC,IAAIT,WAAWa,UAC5Cd,QAAQS,KAAK,aAAaC,IAAIT,WAAWc,WACzCf,QAAQS,KAAK,aAAaC,IAAIT,WAAWe,wBAI9C9B"}